<!-- dice.html ç¤ºä¾‹ç‰‡æ®µï¼ˆæ›´çœŸå® 3D éª°å­ï¼‰ -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ğŸ² çœŸå® 3D éª°å­</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    canvas { display: block; }
    #result { position: absolute; top: 20px; left: 20px; color: white; font-size: 24px; }
    #rollBtn {
      position: absolute; top: 20px; right: 20px;
      padding: 10px 20px; font-size: 18px;
      background: #28a745; color: white; border: none; border-radius: 6px;
    }
  </style>
</head>
<body>

<div id="result">ç‚¹æ•°: -</div>
<button id="rollBtn">ğŸ² æŠ•æ·éª°å­</button>
<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById("canvas") });
renderer.setSize(window.innerWidth, window.innerHeight);

const geometry = new THREE.BoxGeometry();
const materials = [
  new THREE.MeshBasicMaterial({ color: 'white', map: createFace(1) }),
  new THREE.MeshBasicMaterial({ color: 'white', map: createFace(6) }),
  new THREE.MeshBasicMaterial({ color: 'white', map: createFace(2) }),
  new THREE.MeshBasicMaterial({ color: 'white', map: createFace(5) }),
  new THREE.MeshBasicMaterial({ color: 'white', map: createFace(3) }),
  new THREE.MeshBasicMaterial({ color: 'white', map: createFace(4) }),
];
const dice = new THREE.Mesh(geometry, materials);
scene.add(dice);

camera.position.z = 3;

// åŠ¨æ€ç”Ÿæˆç‚¹æ•°çº¹ç†
function createFace(n) {
  const size = 128;
  const canvas = document.createElement("canvas");
  canvas.width = size; canvas.height = size;
  const ctx = canvas.getContext("2d");
  ctx.fillStyle = "#fff"; ctx.fillRect(0, 0, size, size);
  ctx.fillStyle = "#000"; ctx.font = "bold 80px sans-serif";
  ctx.textAlign = "center"; ctx.textBaseline = "middle";
  ctx.fillText(n, size/2, size/2);
  const texture = new THREE.CanvasTexture(canvas);
  return texture;
}

// åŠ¨ç”»
function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();

// æŠ•æ·é€»è¾‘
document.getElementById("rollBtn").onclick = async () => {
  const res = await fetch("/dice/play", { method: "POST" });
  const data = await res.json();
  document.getElementById("result").innerText = `ç‚¹æ•°: ${data.user}`;
  rollDiceTo(data.user);
};

// ç®€å•è§’åº¦æ˜ å°„
function rollDiceTo(n) {
  const rotMap = {
    1: [0, 0],      // æ­£é¢
    2: [Math.PI / 2, 0],     // åº•é¢
    3: [0, -Math.PI / 2],    // å³ä¾§
    4: [0, Math.PI / 2],     // å·¦ä¾§
    5: [-Math.PI / 2, 0],    // é¡¶é¢
    6: [0, Math.PI],         // èƒŒé¢
  };
  const [rx, ry] = rotMap[n];
  dice.rotation.x = rx + Math.random() * Math.PI * 2;
  dice.rotation.y = ry + Math.random() * Math.PI * 2;
}
</script>

</body>
</html>
